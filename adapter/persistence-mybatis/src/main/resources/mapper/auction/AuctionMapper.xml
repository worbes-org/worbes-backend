<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.worbes.adapter.mybatis.auction.AuctionMapper">
    <insert id="upsertAll">
        INSERT INTO auction (
        id,
        item_id,
        quantity,
        price,
        region,
        realm_id,
        created_at
        )
        VALUES
        <foreach collection="auctions" item="a" separator=",">
            (
            #{a.id},
            #{a.itemId},
            #{a.quantity},
            #{a.price},
            #{a.region},
            #{a.realmId},
            NOW()
            )
        </foreach>
        ON CONFLICT (id) DO UPDATE SET
        quantity = EXCLUDED.quantity
        WHERE auction.quantity != EXCLUDED.quantity
    </insert>
</mapper>
